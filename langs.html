<!doctype html>
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>User Language Report</title>
    <script src="https://cdn.zinggrid.com/zinggrid.min.js" defer></script>
    <script src="https://cdn.zingchart.com/zingchart.min.js" defer></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen,
            Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif;
            margin: 1rem 2rem;
            background: #f9f9f9;
            color: #333;
        }
        h1 {
            font-size: 2.25rem;
            margin-bottom: 0.25rem;
        }
        a {
            color: #2176ff;
            text-decoration: none;
        }
        a:hover {
            text-decoration: underline;
        }
        section {
            background: #eee;
            border-radius: 1rem;
            box-shadow: 0 0.5rem 1rem rgba(0,0,0,0.15);
            padding: 2rem 2.5rem;
            margin-top: 2rem;
            max-width: 960px;
            margin-left: auto;
            margin-right: auto;
        }
        section > h2 {
            font-size: 1.5rem;
            margin-bottom: 0.75rem;
        }
        .intro, .section-content {
            font-size: 1.125rem;
            width: 100%;      /* Fills the card horizontally */
            max-width: none;  /* Remove max width restriction */
            margin-bottom: 1rem;
            margin-left: auto;
            margin-right: auto;
        }
        .datacontent {
            padding: 0;
            background: none;
            box-shadow: none;
        }
        .piechart-card {
            display: flex;
            justify-content: center;
            align-items: center;
            background: #fff;
            border-radius: 1rem;
            box-shadow: 0 0.5rem 1rem rgba(0,0,0,0.10);
            width: 550px;
            height: 400px;
            margin-bottom: 1.5rem;
        }
    </style>
</head>

<body>
    <h1>
        <a href="https://annekelley.site/">annekelley.site</a> User Language Report
    </h1>

    <!-- SECTION: Question -->
    <section aria-label="Report Question">
        <h2>Question</h2>
        <div class="section-content">
            Should we create versions of our webpages in other languages, and serve them based on each userâ€™s native tongue?
        </div>
    </section>

    <!-- SECTION: Data -->
    <section aria-label="User Language Data" class="datacontent">
        <h2>Data</h2>
        <div class="section-content">
            According to our data collection, most site visitors speak English, a significant number are Spanish speakers, and only a handful fall into other categories.
        </div>
        <!-- User Language Pie Chart Card -->
        <div class="piechart-card">
            <div id="userLangPie" style="width: 500px; height: 400px;"></div>
        </div>

    </section>

    <!-- SECTION: Exploration -->
    <section aria-label="Data Exploration">
        <h2>Exploration</h2>
        <div class="section-content">
            Given that Spanish speakers make up a substantial chunk of our users, we might provide Spanish versions for the pages they visit frequently. The following grid displays the pages visited by Spanish speakers, ordered from most to least popular.
        </div>
        <!-- Data grid card below -->
        <div style="background: #fff; border-radius: 1rem; box-shadow: 0 0.5rem 1rem rgba(0,0,0,0.25); padding: 1rem; margin-top: 1rem;">
            <h3 style="margin-top: 0;">Pages to Consider for Spanish Adaptation</h3>
            <div id="spanishVisitsGrid" style="width: 100%;"></div>
        </div>
    </section>

    <!-- SECTION: Action -->
    <section aria-label="Recommended Action">
        <h2>Action</h2>
        <div class="section-content">
            As you can see, the error page, member page for Anne Kelley, homepage, and Perl demos are the most visited among Spanish speakers. Therefore, it would be worthwhile to create Spanish versions of these pages and redirect Spanish speakers to them in our routing. With this approach, we could improve the user experience of our Spanish speaking demographic, making our users appreaciate and visit our site more.
        </div>
    </section>

    <script type="module">
        ZC.LICENSE = ["569d52cefae586f634c54f86dc99e6a9", "b55b025e438fa8a98e32482b5f768ff5"];

        async function renderChart() {
            try {
                const resp = await fetch('https://reporting.annekelley.site/endpoint.php/reports/user-langs');
                const langData = await resp.json();
                const pieLabels = langData.map(row => row.language);
                const pieValues = langData.map(row => parseInt(row.count, 10));
                const userLangColors = ["#27ae60", "#e74c3c", "#f5cba7", "#7f8c8d", "#16a085"];
                const userLangPie = generatePieConfig(pieLabels, pieValues,
                    {
                        threshold: "15%",
                        others: { text: "Others", backgroundColor: "#2980b9" },
                        slice: 0.6
                    }, userLangColors.slice(0,pieValues.length)
                );
                zingchart.render({ id: 'userLangPie', data: JSON.stringify(userLangPie), width: 500, height: 400 });
            } catch (err) {
                console.error("Error rendering charts:", err);
            }
        }

        function generatePieConfig(labels, values, options, colors) {
            return {
                type: 'navpie',
                options,
                plot: {
                    borderColor: "#fff",
                    borderWidth: 2,
                    valueBox: [{
                        placement: 'out',
                        text: '%t\n',
                        fontSize: '14',
                        fontFamily: "Open Sans"
                    }],
                    tooltip: {
                        fontSize: '14',
                        fontFamily: "Open Sans",
                        padding: "5 10",
                        text: "%npv%<br>Count: %v"
                    }
                },
                series: labels.map((label, i) => ({
                    text: label,
                    values: [values[i]],
                    backgroundColor: colors[i]
                }))
            }
        }

        async function renderGrid() {
            try {
                const resp = await fetch('https://reporting.annekelley.site/endpoint.php/reports/spanish-pages');
                const data = await resp.json();
                data.forEach(row => { row.Visits = parseInt(row.Visits, 10); });
                const columns = [
                    { index: 'FileName', header: 'File Name', sortable: true },
                    { index: 'Visits', header: 'Total Number of Visits', type: 'number', sortable: true }
                ];
                const grid = document.createElement('zing-grid');
                grid.setAttribute('page-size', '20');
                grid.setAttribute('page-size-options', '10,20,50');
                grid.setAttribute('sort-on-load', 'true');
                grid.setAttribute('sort-column', 'Visits');
                grid.setAttribute('sort-direction', 'desc');
                grid.data = data;
                grid.columns = columns;
                document.getElementById('spanishVisitsGrid').appendChild(grid);
            } catch (error) {
                console.error('Error rendering Spanish Visits Grid:', error);
            }
        }
        renderChart();
        renderGrid();
    </script>
</body>
</html>