<!doctype html>
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Static Data Report — annekelley.site</title>
    <script src="https://annekelley.site/collector.js"></script>
    <script src="https://cdn.zinggrid.com/zinggrid.min.js" defer></script>
    <script src="https://cdn.zingchart.com/zingchart.min.js" defer></script>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif; margin: 1rem 2rem; background: #f9f9f9; color:#222 }
        h1{ font-size:1.8rem }
        a { color:#2176ff; text-decoration:none }
        section { background:#eee;border-radius:1rem;padding:1.5rem;margin-top:1.25rem;max-width:960px;margin-left:auto;margin-right:auto }
        .grid-card, .chart-card { background:#fff;border-radius:0.75rem;padding:1rem;box-shadow:0 0.5rem 1rem rgba(0,0,0,0.12);margin-top:1rem }
        .card-row { display:flex;gap:1rem;flex-wrap:wrap }
        .small-chart { width:320px; }
    </style>
</head>
<body>
    <h1><a href="/">annekelley.site</a> — Static Data Report</h1>
    <nav style="margin-top:0.5rem;">
        <a href="/index.html">Dashboard</a> ·
        <a href="/dynamic.html">Dynamic Report</a> ·
        <a href="/browsers.html">Browsers Report</a>
    </nav>

    <section aria-label="Static Data">
        <h2>Static indicators</h2>
        <div class="card-row">
            <div class="chart-card small-chart">
                <h3 id="acceptsCookiesTitle">acceptsCookies</h3>
                <div id="acceptsCookiesPreview" style="width:100%;height:220px"></div>
            </div>
            <div class="chart-card small-chart">
                <h3 id="allowsJavaScriptTitle">allowsJavaScript</h3>
                <div id="allowsJavaScriptPreview" style="width:100%;height:220px"></div>
            </div>
        </div>

        <div class="grid-card">
            <h3 id="userNetConnTypeTitle">userNetConnType</h3>
            <div id="userNetConnTypeGrid"></div>
        </div>
    </section>

    <script type="module">
        import { countKeyValue } from '/fetch.js';
        ZC.LICENSE = ["569d52cefae586f634c54f86dc99e6a9", "b55b025e438fa8a98e32482b5f768ff5"];

        function generateNavPieConfig(keyValuePairs = {}) {
            return {
                type: 'navpie',
                plot: { detach: true, valueBox: { text: '%t\n%npv%' }, tooltip: { text: '%npv%<br>Count: %v' } },
                series: Object.entries(keyValuePairs).map(([key, value]) => ({ text: key, values: [value] }))
            };
        }

        function createGrid(containerId, rows = [], columns = []){
            const container = document.getElementById(containerId);
            if (!container) return;
            const grid = document.createElement('zing-grid');
            grid.setAttribute('page-size', '10');
            grid.setAttribute('page-size-options', '5,10,20');
            grid.setAttribute('sort-on-load', 'true');
            grid.setAttribute('sort-column', 'value');
            grid.setAttribute('sort-direction', 'desc');
            grid.data = rows;
            grid.columns = columns;
            container.innerHTML = '';
            container.appendChild(grid);
        }

        async function render() {
            try {
                const [acceptsCookiesKV, allowsJavaScriptKV, userNetConnTypeKV] = await Promise.all([
                    countKeyValue('static','acceptsCookies'),
                    countKeyValue('static','allowsJavaScript'),
                    countKeyValue('static','userNetConnType')
                ]);

                // Pie charts
                const acceptsCfg = generateNavPieConfig(acceptsCookiesKV || {});
                const allowsCfg = generateNavPieConfig(allowsJavaScriptKV || {});
                zingchart.render({ id: 'acceptsCookiesPreview', data: acceptsCfg, width: '100%', height: 220 });
                zingchart.render({ id: 'allowsJavaScriptPreview', data: allowsCfg, width: '100%', height: 220 });

                // Grid
                const rows = Object.entries(userNetConnTypeKV || {}).map(([k,v]) => ({ connection: k, count: Number(v) }));
                createGrid('userNetConnTypeGrid', rows, [ { index: 'connection', header: 'Connection Type' }, { index: 'count', header: 'Count', type: 'number' }]);
            } catch (err) {
                console.error('Static report render error:', err);
            }
        }

        render();
    </script>
</body>
</html>
